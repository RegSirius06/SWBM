# Сайт с банком и мессенджером

## Я вдохновлялся и использовал как образец данные репозитории: https://github.com/RegSirius06/lisbank, https://github.com/RegSirius06/VeAr_code и https://github.com/RegSirius06/messenger_for_LFMSH

## Что это?

Это сайт, предоставляющий модель банковской системы. Работает это так:
- Есть аккаунт администратора, у которого устанавливается начальный счёт;
- Создаются некоторые аккаунты, которые могут символизировать компании, рабочих и т.д.
- Создавая транзакции-имитации реальных денежных процессов, можно создать систему финансового учёта.

Система адаптирована для лагерей с экономической игрой.

Также прилагается мессенджер для обеспечения коммуникаций рабочих строго внутри компании.

## Как использовать

Нужно установить Python 3.11 и младше, если вы этого не сделали.

После этого установить недостающие библиотеки:

```bash
pip install -r requirements.txt
```

В консоли перейти в папку, где есть файл "manage.py", сгенерировать базу данных и запустить сервер, используя этот файл.

Сайт доступен в локальной сети по адресу "192.168.50.40:8000", если адрес вашего ПК в локальной сети "192.168.50.40". Также в консоли будет выведен адрес маршрутизатора, если вы его использовали.

### Маршрутизатор

Используется маршрутизатор от [ngrok](https://ngrok.com/).

Чтобы его использовать, нужно произвести регистрацию на [сайте](https://ngrok.com/) и запросить токен (есть бесплатный и платный вариант).

Токен могут увидеть авторизованные пользователи [по данной ссылке](https://dashboard.ngrok.com/get-started/your-authtoken).

Токен нужно положить в json-файл в папку server примерно так:

```json
{
    "authtoken": "YOUR_NGROK_TOKEN_HERE"
}
```

**ВАЖНО!**
Файл должен называться _ngrok.json_ и никак иначе!

Если токен будет иметь другой ключ (не *authtoken*), программа не сможет его опознать, и это приведёт к ошибкам.

Ссылка на сайт, пропущенный через маршрутизатор, появляется в консоле при запуске сервера. Также ссылку можно всегда получить в телеграмм-боте.

### Telegram bot

Здесь такая же система. Чтобы запустился бот, ему нужен токен. Как получить токен для telegram-бота, думаю, рассказано везде. И всё же оставлю ссылку на [гайд](https://timeweb.com/ru/community/articles/token-bota-telegram-kak-sdelat-gde-vzyat-i-kuda-vstavlyat).

Токен нужно положить в json-файл в папку tele_bot примерно так:

```json
{
    "token": "YOUR_BOT_TOKEN_HERE"
}
```

**ВАЖНО!**
Файл должен называться _telebot.json_ и никак иначе!

### Как настроить telegram-бота и ngrok для скомпилированной версии?

Точно также, но все папки проекта находятся в папке программы *Lib*.

## Интерфейс банка и админ-панели

Интерфейс банка и админ-панели интуитивно понятен. Все транзакции и пользователи нужно изменять/добавлять именно на сайте, а не в admin-панели, чтобы не возникло проблем.

Для разрешения переводов средств для учатсников смены нужно в группе "listener" добавить разрешение "Может совершать переводы". Если вы регистрировали пользователей автоматически на сайте, то у вас не должно возникнуть проблем с этим.

Чтобы добавить человека в мерию (в ЛИСе такое есть), нужно зайти в admin-панель, найти его аккаунт в списке пользователей ("Пользователи", не "Accounts") и добавить к пользователю группу "meria". Отозвать права можно аналогичным образом.

Только поле "Roolss" admin-панели заполняется в admin-панели, всё остальное создаётся автоматически или вручную на сайте.

## Регистрация пользователей

Пользователей можно зарегистрировать в разделе "Работа с пользователями". После регистрации его логин и пароль будут записаны в в файл "All_users.txt". Обратите внимание, что при удалении пользователя запись о нём в файле остаётся.

При сбросе всех паролей будут обновлены пароли у всех пользователей, логин которых не содержит текста "admin". После сброса паролей обновлённый список будет находиться в файле "All_users.txt".

При регистрации можно использовать файлы `.txt` или `.csv`, предварительно отформатированные в соответствии с шаблоном:

|Фамилия|Имя|Отчество|Отряд|Группа|
|-|-|-|-|-|

*Так регистрируют детей/пионеров/обычных пользователей.*

|Фамилия|Имя|Отчество|
|-|-|-|

*Так регистрируют педагогический состав/пользователей с привилегиями.*

При регистрации нужно выбрать тип пользователей (пионер или педагог) и прописать путь до файла на устройстве.

Такая страница находится в разделе работы с пользователями.

## Команды и комментарии

Я рекомендую вам использовать именно данную конфигурацию сайта. 

Важно упомянуть, что здесь существует две необходимые пользовательские команды, которые я опишу ниже.

### python manage.py initdb

Эта команда создаст базу данных с необходимыми для начала работы настройками. По-умолчанию, создаётся один пользователь - admin, которому (при желании) можно установить почту и пароль.

##### так вы можете указать почту
```bash
python manage.py initdb --email customemail@example.com
```

##### а так - свой пароль
```bash
python manage.py initdb --password PASSWORD
```

Данные для входа в аккаунт администратора:

|Данные для входа|Значение|
|----------------|--------|
|login:          |admin   |
|password:       |admin (По-умолчанию)|

Изменять профиль этого аккаунта крайне не рекомендуется; можно менять только поля статуса, баланса, группы.
Нельзя менять логин этого пользователя, группы, в которых он состоит, фамилию, имя, отчество, пользователя, отряд в аккаунте, связанном с этим пользователем.

Сменить можно эти поля на admin-панели (её адрес, например, localhost:8000/admin/) в разделе "Пользователи", или на самом сайте, если такая возможность предоставляется.

### python manage.py betterrunserver

Команда для запуска сервера. Будет дополнительно запускать телеграмм-бота и маршрутизатор локального сервера в глобальную сеть.

Есть возможность
-   указать свой адрес сервера:
    ```bash
    python manage.py betterrunserver --host 0.0.0.0:8000
    ```
    _0.0.0.0:8000 - значение по-умолчанию_

-   не запускать маршрутизатор:
    ```bash
    python manage.py betterrunserver --nongrok
    ```

-   не запускать телеграм-бота:
    ```bash
    python manage.py betterrunserver --notelebot
    ```

-   не запускать автотранзакции:
    ```bash
    python manage.py betterrunserver --noautotransactions
    ```

Команде можно дать несколько параметров.

После успешного создания базы данных и запуска сервера можно перейти непосредственно на сайт (по адресу, например, "localhost:8000") или через маршрутизатор, ссылку на который можно получить в телеграмм-боте или в консоли при запуске програмы.

### **ВАЖНО!**

Для работы маршрутизатора не нужно открывать порты.

Некоторые страницы сайта могут распознаваться как ненадёжные. Причина этого мне не известна, но при посещении тех же самых страниц в локальной сети подобного явления не происходит.

Так что эти предупреждения можно игнорировать. Полагаю, это особенность маршрутизатора.

### Как запустить скомпилированную версию?

Просто файлом `start.bat`. В целом, особо ничего больше не надо.

Тем не менее, вы можете использовать команды как и обычно, обращаясь к файлу `manage.exe`. Например (в консоли):

```bash
manage betterrunserver
```

## Удачного пользования!
